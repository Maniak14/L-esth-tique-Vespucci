<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin - L'Esth√©tique Vespucci</title>
  <link rel="icon" type="image/png" href="img/V.png">
  <link rel="stylesheet" href="assets/styles-logo.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>
  <script src="firebase-db.js"></script>
  <script>
    // V√©rifier l'authentification avant d'afficher la page
    if (sessionStorage.getItem('adminAuthenticated') !== 'true') {
      // Utiliser un chemin absolu depuis la racine
      const rootPath = window.location.origin + window.location.pathname.split('/').slice(0, -1).join('/');
      window.location.href = rootPath + '/admin-login.html';
    }
    
    // Force scroll to top immediately on page load
    if ('scrollRestoration' in history) {
      history.scrollRestoration = 'manual';
    }
    window.scrollTo(0, 0);
  </script>
  <style>
    .admin-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
      background: var(--bg-dark);
      min-height: 100vh;
    }
    
    .admin-header {
      text-align: center;
      margin-bottom: 3rem;
      padding: 2rem;
      background: var(--surface);
      border-radius: 20px;
      border: 1px solid var(--border);
    }
    
    .admin-header h1 {
      color: var(--text-primary);
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }
    
    .admin-section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
    }
    
    .admin-section h2 {
      color: var(--text-primary);
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      border-bottom: 2px solid var(--primary);
      padding-bottom: 0.5rem;
    }
    
    .image-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
    }
    
    .image-item {
      position: relative;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      min-height: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      backdrop-filter: blur(20px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    .image-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--primary) 0%, transparent 70%);
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 0;
    }
    
    .image-item:hover {
      border-color: var(--primary);
      transform: translateY(-8px);
      box-shadow: 0 12px 40px rgba(32, 178, 170, 0.3);
    }
    
    .image-item:hover::before {
      opacity: 0.05;
    }
    
    .image-item.drag-over {
      border-color: var(--accent);
      background: rgba(32, 178, 170, 0.1);
    }
    
    .image-item img {
      max-width: 100%;
      max-height: 200px;
      width: 100%;
      height: 200px;
      border-radius: 15px;
      object-fit: cover;
      margin-bottom: 1rem;
      position: relative;
      z-index: 1;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
    }
    
    .image-item:hover img {
      transform: scale(1.05);
    }
    
    /* Image preview container */
    .image-preview-container {
      width: 100%;
      margin: 1rem 0;
      position: relative;
      z-index: 1;
    }
    
    .image-preview-wrapper {
      width: 100%;
      height: 200px;
      border-radius: 50%;
      overflow: hidden;
      margin: 0 auto;
      border: 3px solid var(--primary);
      background: var(--bg-dark);
      position: relative;
      box-shadow: 0 8px 30px rgba(32, 178, 170, 0.3);
    }
    
    .image-preview-wrapper.rectangular {
      border-radius: 15px;
    }
    
    .image-preview-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: object-position 0.2s ease;
    }
    
    .image-position-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.5rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }
    
    .position-btn {
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text-primary);
      width: 40px;
      height: 40px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      transition: all 0.3s ease;
      font-weight: bold;
    }
    
    .position-btn:hover {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
      transform: scale(1.1);
    }
    
    .position-btn:active {
      transform: scale(0.95);
    }
    
    .position-display {
      min-width: 80px;
      text-align: center;
      font-size: 0.85rem;
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    .image-item .image-label {
      color: var(--text-primary);
      font-size: 1rem;
      font-weight: 600;
      margin-top: 0.5rem;
      margin-bottom: 1rem;
      position: relative;
      z-index: 1;
    }
    
    .image-item .remove-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(255, 0, 0, 0.8);
      color: white;
      border: none;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      cursor: pointer;
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .image-item:hover .remove-btn {
      opacity: 1;
    }
    
    .drop-zone {
      border: 2px dashed var(--primary);
      border-radius: 15px;
      padding: 2rem;
      text-align: center;
      color: var(--text-secondary);
      background: rgba(32, 178, 170, 0.05);
      transition: all 0.3s ease;
    }
    
    .drop-zone.drag-over {
      background: rgba(32, 178, 170, 0.2);
      border-color: var(--accent);
    }
    
    .save-btn {
      background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
      color: white;
      border: none;
      padding: 1.2rem 2rem;
      border-radius: 15px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 3rem;
      width: 100%;
      box-shadow: 0 8px 30px rgba(32, 178, 170, 0.4);
      position: relative;
      overflow: hidden;
    }
    
    .save-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }
    
    .save-btn:hover::before {
      left: 100%;
    }
    
    .save-btn:hover {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      transform: translateY(-3px);
      box-shadow: 0 12px 40px rgba(32, 178, 170, 0.5);
    }
    
    .save-btn:active {
      transform: translateY(-1px);
    }
    
    .input-url {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--bg-dark);
      color: var(--text-primary);
      margin-top: 0.5rem;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      position: relative;
      z-index: 1;
    }
    
    .input-url:focus {
      outline: none;
      border-color: var(--primary);
      background: var(--surface);
      box-shadow: 0 0 0 3px rgba(32, 178, 170, 0.1);
    }
    
    /* Style sp√©cifique pour les inputs de type number */
    input[type="number"].input-url {
      color: #ffffff !important;
      font-weight: 600;
      font-size: 1rem;
      background: rgba(32, 178, 170, 0.1);
      text-align: center;
    }
    
    input[type="number"].input-url:focus {
      color: #ffffff !important;
      background: rgba(32, 178, 170, 0.2);
    }
    
    .url-input-group {
      margin-bottom: 1rem;
    }
    
    .url-input-group label {
      color: var(--text-primary);
      display: block;
      margin-bottom: 0.5rem;
    }
    
    .btn-small {
      background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 0.75rem;
      font-size: 0.9rem;
      font-weight: 600;
      transition: all 0.3s ease;
      position: relative;
      z-index: 1;
      box-shadow: 0 4px 15px rgba(32, 178, 170, 0.3);
    }
    
    .btn-small:hover {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(32, 178, 170, 0.4);
    }
    
    .success-message {
      background: rgba(0, 255, 0, 0.2);
      color: #00ff00;
      padding: 1rem;
      border-radius: 10px;
      margin-top: 1rem;
      text-align: center;
      display: none;
    }
    
    .success-message.show {
      display: block;
    }
    
    .add-image-btn {
      background: var(--surface);
      border: 2px dashed var(--primary);
      border-radius: 20px;
      padding: 2.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      min-height: 250px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: var(--primary);
      font-size: 3.5rem;
      font-weight: 300;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      margin-top: 2rem;
    }
    
    .add-image-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--primary) 0%, transparent 70%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .add-image-btn:hover {
      background: rgba(32, 178, 170, 0.1);
      border-color: var(--primary-light);
      border-style: solid;
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 12px 40px rgba(32, 178, 170, 0.3);
    }
    
    .add-image-btn:hover::before {
      opacity: 0.1;
    }
    
    .add-image-btn > div {
      position: relative;
      z-index: 1;
      transition: transform 0.3s ease;
    }
    
    .add-image-btn:hover > div {
      transform: scale(1.2);
    }
    
    .add-image-btn span {
      font-size: 1.1rem;
      margin-top: 0.75rem;
      color: var(--text-primary);
      font-weight: 500;
      position: relative;
      z-index: 1;
    }
    
    .delete-image-btn {
      position: absolute;
      top: 10px;
      left: 10px;
      background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
      color: white;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      cursor: pointer;
      font-size: 1.2rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 10;
      box-shadow: 0 4px 15px rgba(255, 68, 68, 0.4);
    }
    
    .delete-image-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(255, 68, 68, 0.6);
    }
    
    .image-item:hover .delete-image-btn {
      opacity: 1;
    }
    
    .image-item .remove-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: linear-gradient(135deg, #ffaa00 0%, #ff8800 100%);
      color: white;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      cursor: pointer;
      font-size: 1.2rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 10;
      box-shadow: 0 4px 15px rgba(255, 170, 0, 0.4);
    }
    
    .image-item .remove-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(255, 170, 0, 0.6);
    }
    
    .image-item:hover .remove-btn {
      opacity: 1;
    }
    
    /* Team member fields styling */
    .image-item .team-fields {
      margin-top: 1rem;
      display: grid;
      gap: 0.75rem;
      width: 100%;
      position: relative;
      z-index: 1;
    }
    
    .image-item .team-fields .input-url {
      background: var(--surface);
      border: 1px solid var(--border);
      transition: all 0.3s ease;
    }
    
    .image-item .team-fields .input-url:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(32, 178, 170, 0.15);
    }
    
    .image-item .team-fields .input-url::placeholder {
      color: var(--text-secondary);
      opacity: 0.7;
    }
    
    /* Admin section improvements */
    .admin-section {
      backdrop-filter: blur(20px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    .admin-header {
      backdrop-filter: blur(20px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body>
  <!-- Animated Background -->
  <div class="animated-bg">
    <div class="gradient-orb orb-1"></div>
    <div class="gradient-orb orb-2"></div>
    <div class="gradient-orb orb-3"></div>
    <div class="noise-overlay"></div>
  </div>

  <!-- Geometric Shapes -->
  <div class="geometric-shapes">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
  </div>

  <!-- Navigation -->
  <nav class="main-nav">
    <div class="nav-container">
      <a href="index.html" class="logo">
        <img src="img/V.png" alt="Logo Vespucci" class="logo-image">
        <div class="logo-text-wrapper">
          <span class="logo-text">VESPUCCI</span>
          <span class="logo-subtitle">ESTH√âTIQUE</span>
        </div>
      </a>
      <div class="nav-links">
        <a href="index.html" class="nav-item">Accueil</a>
        <a href="tarifs.html" class="nav-item">Tarifs</a>
        <a href="femmes.html" class="nav-item">Femmes</a>
        <a href="hommes.html" class="nav-item">Hommes</a>
        <a href="admin.html" class="nav-item active">Admin</a>
      </div>
      <button class="nav-toggle" id="navToggle">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>

  <div class="admin-container" style="padding-top: 8rem;">
    <div class="admin-header">
      <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; flex-wrap: wrap; gap: 1rem;">
        <div>
          <h1>üîß Administration - L'Esth√©tique Vespucci</h1>
          <p style="color: var(--text-secondary);">G√©rez les images de votre site</p>
        </div>
        <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
          <button onclick="testFirebaseConnection()" id="firebaseTestBtn" style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); color: #3b82f6; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease; white-space: nowrap;" onmouseover="this.style.background='rgba(59, 130, 246, 0.2)'" onmouseout="this.style.background='rgba(59, 130, 246, 0.1)'" title="Tester la connexion √† Firebase">üîå Test Firebase</button>
          <button onclick="exportAllCatalogData()" style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: #22c55e; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease; white-space: nowrap;" onmouseover="this.style.background='rgba(34, 197, 94, 0.2)'" onmouseout="this.style.background='rgba(34, 197, 94, 0.1)'" title="T√©l√©charger catalog-images.json avec toutes les donn√©es">üì• Exporter tout (JSON)</button>
          <button onclick="logout()" style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); color: #ef4444; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease; white-space: nowrap;" onmouseover="this.style.background='rgba(239, 68, 68, 0.2)'" onmouseout="this.style.background='rgba(239, 68, 68, 0.1)'">D√©connexion</button>
        </div>
      </div>
    </div>

    <!-- Export Global Section -->
    <div id="globalExportResult" style="display: none; background: var(--bg-dark); border: 2px solid var(--primary); border-radius: 15px; padding: 1.5rem; margin-bottom: 2rem;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h3 style="color: var(--text-primary); font-size: 1.2rem; margin: 0;">üìã Fichier catalog-images.json (t√©l√©charg√© automatiquement)</h3>
        <button onclick="copyGlobalExport()" class="btn-small" style="background: var(--primary); color: white;">üìã Copier le JSON</button>
      </div>
      <textarea id="globalExportData" readonly style="width: 100%; min-height: 300px; padding: 1rem; border: 1px solid var(--border); border-radius: 10px; background: var(--surface); color: var(--text-primary); font-family: monospace; font-size: 0.85rem; resize: vertical;"></textarea>
      <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 1rem; margin-bottom: 0;">üí° Le fichier a √©t√© t√©l√©charg√© automatiquement. Vous pouvez aussi copier le JSON ci-dessus pour le coller dans catalog-images.json</p>
    </div>

    <!-- Team Images Section -->
    <div class="admin-section">
      <h2>Photos de l'√âquipe</h2>
      <div class="image-grid" id="teamImages">
        <!-- Team images will be loaded here -->
      </div>
      <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
        <div class="add-image-btn" onclick="addNewTeamMember()" title="Ajouter un nouvel employ√©">
          <div>+</div>
          <span>Ajouter un employ√©</span>
        </div>
        <button class="btn-small" onclick="exportTeamData()" style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: #22c55e;">üì• Exporter les donn√©es</button>
      </div>
      <div id="teamExportResult" style="display: none; margin-top: 1rem; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 15px; padding: 1.5rem;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <h3 style="color: var(--text-primary); font-size: 1.1rem; margin: 0;">üìã Donn√©es export√©es (copiez ceci) :</h3>
          <button onclick="copyTeamExport()" class="btn-small" style="background: var(--primary); color: white;">üìã Copier</button>
        </div>
        <textarea id="teamExportData" readonly style="width: 100%; min-height: 200px; padding: 1rem; border: 1px solid var(--border); border-radius: 10px; background: var(--surface); color: var(--text-primary); font-family: monospace; font-size: 0.85rem; resize: vertical;"></textarea>
      </div>
    </div>

    <!-- Gallery Images Section -->
    <div class="admin-section">
      <h2>Galerie (Carousel)</h2>
      <div class="image-grid" id="galleryImages">
        <!-- Gallery images will be loaded here -->
      </div>
      <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
        <div class="add-image-btn" onclick="addNewGalleryImage()" title="Ajouter une nouvelle image">
          <div>+</div>
          <span>Ajouter une image</span>
        </div>
        <button class="btn-small" onclick="exportGalleryData()" style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: #22c55e;">üì• Exporter les donn√©es</button>
      </div>
      <div id="galleryExportResult" style="display: none; margin-top: 1rem; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 15px; padding: 1.5rem;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <h3 style="color: var(--text-primary); font-size: 1.1rem; margin: 0;">üìã Donn√©es export√©es (copiez ceci) :</h3>
          <button onclick="copyGalleryExport()" class="btn-small" style="background: var(--primary); color: white;">üìã Copier</button>
        </div>
        <textarea id="galleryExportData" readonly style="width: 100%; min-height: 200px; padding: 1rem; border: 1px solid var(--border); border-radius: 10px; background: var(--surface); color: var(--text-primary); font-family: monospace; font-size: 0.85rem; resize: vertical;"></textarea>
      </div>
    </div>

    <!-- Femmes Catalog Section -->
    <div class="admin-section">
      <h2>Catalogue Femmes</h2>
      
      <!-- Ajout en masse d'URLs -->
      <div style="background: var(--bg-dark); border: 1px solid var(--border); border-radius: 15px; padding: 1.5rem; margin-bottom: 2rem;">
        <h3 style="color: var(--text-primary); font-size: 1.2rem; margin-bottom: 1rem;">üìã Ajout en masse d'URLs</h3>
        <div style="background: rgba(32, 178, 170, 0.1); border: 1px solid var(--primary); border-radius: 10px; padding: 1rem; margin-bottom: 1rem;">
          <p style="color: var(--text-primary); font-size: 0.9rem; margin: 0 0 0.5rem 0; font-weight: 600;">üìñ Comment obtenir les URLs depuis Goopics :</p>
          <ol style="color: var(--text-secondary); font-size: 0.85rem; margin: 0; padding-left: 1.5rem; line-height: 1.6;">
            <li>Allez sur <strong>goopics.net</strong> et uploadez vos images</li>
            <li>Pour chaque image, cliquez sur <strong>"Lien direct"</strong> (ou "Direct link")</li>
            <li>Copiez l'URL qui commence par <code>https://i.goopics.net/...</code></li>
            <li>Collez toutes les URLs ici (une par ligne) dans l'ordre souhait√©</li>
          </ol>
        </div>
        <textarea id="femmesUrlsBulk" placeholder="https://i.goopics.net/abc123.png&#10;https://i.goopics.net/def456.png&#10;https://i.goopics.net/ghi789.png" style="width: 100%; min-height: 150px; padding: 0.75rem; border: 1px solid var(--border); border-radius: 10px; background: var(--surface); color: var(--text-primary); font-family: monospace; font-size: 0.85rem; margin-bottom: 1rem; resize: vertical;"></textarea>
        <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
          <button class="btn-small" onclick="cleanFemmesUrls()" style="flex: 1;">üßπ Nettoyer les URLs</button>
          <button class="btn-small" onclick="addBulkFemmesUrls()" style="flex: 2;">‚ûï Ajouter toutes les URLs</button>
        </div>
        <div id="femmesBulkResult" style="margin-top: 1rem; display: none;"></div>
      </div>
      
      <div class="image-grid" id="femmesCatalog">
        <!-- Femmes images will be loaded here -->
      </div>
      <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
        <div class="add-image-btn" onclick="addNewFemmesImage()" title="Ajouter une nouvelle image">
          <div>+</div>
          <span>Ajouter une image</span>
        </div>
        <button class="btn-small" onclick="insertFemmesImageAtPosition()" style="background: rgba(59, 130, 246, 0.12); border: 1px solid rgba(59, 130, 246, 0.4); color: #3b82f6;">‚ÜïÔ∏è Ins√©rer √† une position</button>
        <button class="btn-small" onclick="exportFemmesData()" style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: #22c55e;">üì• Exporter les donn√©es</button>
      </div>
      <div id="femmesExportResult" style="display: none; margin-top: 1rem; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 15px; padding: 1.5rem;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <h3 style="color: var(--text-primary); font-size: 1.1rem; margin: 0;">üìã Donn√©es export√©es (copiez ceci) :</h3>
          <button onclick="copyFemmesExport()" class="btn-small" style="background: var(--primary); color: white;">üìã Copier</button>
        </div>
        <textarea id="femmesExportData" readonly style="width: 100%; min-height: 200px; padding: 1rem; border: 1px solid var(--border); border-radius: 10px; background: var(--surface); color: var(--text-primary); font-family: monospace; font-size: 0.85rem; resize: vertical;"></textarea>
      </div>
    </div>

    <!-- Hommes Catalog Section -->
    <div class="admin-section">
      <h2>Catalogue Hommes</h2>
      
      <!-- Ajout en masse d'URLs -->
      <div style="background: var(--bg-dark); border: 1px solid var(--border); border-radius: 15px; padding: 1.5rem; margin-bottom: 2rem;">
        <h3 style="color: var(--text-primary); font-size: 1.2rem; margin-bottom: 1rem;">üìã Ajout en masse d'URLs</h3>
        <div style="background: rgba(32, 178, 170, 0.1); border: 1px solid var(--primary); border-radius: 10px; padding: 1rem; margin-bottom: 1rem;">
          <p style="color: var(--text-primary); font-size: 0.9rem; margin: 0 0 0.5rem 0; font-weight: 600;">üìñ Comment obtenir les URLs depuis Goopics :</p>
          <ol style="color: var(--text-secondary); font-size: 0.85rem; margin: 0; padding-left: 1.5rem; line-height: 1.6;">
            <li>Allez sur <strong>goopics.net</strong> et uploadez vos images</li>
            <li>Pour chaque image, cliquez sur <strong>"Lien direct"</strong> (ou "Direct link")</li>
            <li>Copiez l'URL qui commence par <code>https://i.goopics.net/...</code></li>
            <li>Collez toutes les URLs ici (une par ligne) dans l'ordre souhait√©</li>
          </ol>
        </div>
        <textarea id="hommesUrlsBulk" placeholder="https://i.goopics.net/abc123.png&#10;https://i.goopics.net/def456.png&#10;https://i.goopics.net/ghi789.png" style="width: 100%; min-height: 150px; padding: 0.75rem; border: 1px solid var(--border); border-radius: 10px; background: var(--surface); color: var(--text-primary); font-family: monospace; font-size: 0.85rem; margin-bottom: 1rem; resize: vertical;"></textarea>
        <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
          <button class="btn-small" onclick="cleanHommesUrls()" style="flex: 1;">üßπ Nettoyer les URLs</button>
          <button class="btn-small" onclick="addBulkHommesUrls()" style="flex: 2;">‚ûï Ajouter toutes les URLs</button>
        </div>
        <div id="hommesBulkResult" style="margin-top: 1rem; display: none;"></div>
      </div>
      
      <div class="image-grid" id="hommesCatalog">
        <!-- Hommes images will be loaded here -->
      </div>
      <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
        <div class="add-image-btn" onclick="addNewHommesImage()" title="Ajouter une nouvelle image">
          <div>+</div>
          <span>Ajouter une image</span>
        </div>
        <button class="btn-small" onclick="insertHommesImageAtPosition()" style="background: rgba(59, 130, 246, 0.12); border: 1px solid rgba(59, 130, 246, 0.4); color: #3b82f6;">‚ÜïÔ∏è Ins√©rer √† une position</button>
        <button class="btn-small" onclick="exportHommesData()" style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: #22c55e;">üì• Exporter les donn√©es</button>
      </div>
      <div id="hommesExportResult" style="display: none; margin-top: 1rem; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 15px; padding: 1.5rem;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <h3 style="color: var(--text-primary); font-size: 1.1rem; margin: 0;">üìã Donn√©es export√©es (copiez ceci) :</h3>
          <button onclick="copyHommesExport()" class="btn-small" style="background: var(--primary); color: white;">üìã Copier</button>
        </div>
        <textarea id="hommesExportData" readonly style="width: 100%; min-height: 200px; padding: 1rem; border: 1px solid var(--border); border-radius: 10px; background: var(--surface); color: var(--text-primary); font-family: monospace; font-size: 0.85rem; resize: vertical;"></textarea>
      </div>
    </div>

    <!-- Hero Image Section -->
    <div class="admin-section">
      <h2>Image Hero</h2>
      <div class="image-grid" id="heroImage">
        <!-- Hero image will be loaded here -->
      </div>
    </div>

    <!-- Map Image Section -->
    <div class="admin-section">
      <h2>Carte de Localisation</h2>
      <div class="image-grid" id="mapImage">
        <!-- Map image will be loaded here -->
      </div>
    </div>

    <button class="save-btn" onclick="saveAllImages()">üíæ Sauvegarder toutes les modifications</button>
    <div class="success-message" id="successMessage">‚úÖ Modifications sauvegard√©es avec succ√®s !</div>
  </div>

  <!-- Footer -->
  <footer class="main-footer">
    <div class="footer-content">
      <div class="footer-brand">
        <a href="index.html" class="footer-logo">
          <img src="img/V.png" alt="Logo Vespucci" class="footer-logo-image">
          <div class="footer-logo-text-wrapper">
            <span class="footer-logo-text">VESPUCCI</span>
            <span class="footer-logo-subtitle">ESTH√âTIQUE</span>
          </div>
        </a>
        <p>L'Esth√©tique Vespucci ¬© 2025</p>
      </div>
      <div class="footer-links">
        <a href="index.html">Accueil</a>
        <a href="femmes.html">Femmes</a>
        <a href="tarifs.html">Tarifs</a>
        <a href="hommes.html">Hommes</a>
      </div>
    </div>
  </footer>

  <script>
    // Image configuration
    const imageConfig = {
      team: [
        { id: 'julio', name: 'Julio Alvarez', default: 'https://i.goopics.net/pjtgz1.png' },
        { id: 'soren', name: 'Soren Wanks', default: 'https://i.goopics.net/8y3mgo.png' },
        { id: 'sun', name: 'Sun Price', default: 'https://i.goopics.net/t7adhn.png' },
        { id: 'inaya', name: 'Inaya Kinslow', default: 'https://i.goopics.net/zyg7y5.png' },
        { id: 'andres', name: 'Andres Henarnandez', default: 'https://i.goopics.net/xloucg.png' },
        { id: 'yoruhime', name: 'Yoruhime Yoshikage', default: 'https://i.goopics.net/15utm9.png' }
      ],
      gallery: [
        { id: 'gallery1', name: 'Galerie 1', default: 'img/carousel/1.png' },
        { id: 'gallery2', name: 'Galerie 2', default: 'img/carousel/2.png' },
        { id: 'gallery3', name: 'Galerie 3', default: 'img/carousel/3.png' },
        { id: 'gallery4', name: 'Galerie 4', default: 'img/carousel/4.png' },
        { id: 'gallery5', name: 'Galerie 5', default: 'img/carousel/5.png' },
        { id: 'gallery6', name: 'Galerie 6', default: 'img/carousel/6.png' }
      ],
      hero: { id: 'hero', name: 'Image Hero', default: 'img/hero.png' },
      map: { id: 'map', name: 'Carte', default: 'img/map.png' }
    };

    // Initialize Firebase on page load
    // Note: firebaseInitialized is declared in firebase-db.js
    // Create local reference to avoid errors
    let firebaseInitialized = false;
    
    document.addEventListener('DOMContentLoaded', async () => {
      if (initFirebaseDB && typeof initFirebaseDB === 'function') {
        const initialized = initFirebaseDB();
        window.firebaseInitialized = initialized;
        firebaseInitialized = initialized; // Local reference
        if (initialized) {
          // Charger toutes les donn√©es depuis Firebase
          await loadAllDataFromFirebase();
          // √âcouter les changements en temps r√©el
          watchImages(() => {
            console.log('Images mises √† jour depuis Firebase');
            // Recharger les images si n√©cessaire
            if (typeof loadTeamMembers === 'function') {
              loadTeamMembers();
            }
            // Recharger les catalogues
            if (typeof loadFemmesCatalog === 'function') {
              loadFemmesCatalog();
            }
            if (typeof loadHommesCatalog === 'function') {
              loadHommesCatalog();
            }
          });
          watchPositions(() => {
            console.log('Positions mises √† jour depuis Firebase');
            // Mettre √† jour les positions dans l'interface
            document.querySelectorAll('[id^="preview_"]').forEach(img => {
              const imageId = img.id.replace('preview_', '');
              const position = localStorage.getItem(`image_position_${imageId}`);
              if (position) {
                img.style.objectPosition = position;
                const display = document.querySelector(`#position_display_${imageId}`);
                if (display) {
                  display.textContent = position;
                }
              }
            });
          });
          watchTeamMembers(() => {
            console.log('Membres de l\'√©quipe mis √† jour depuis Firebase');
            if (typeof loadTeamMembers === 'function') {
              loadTeamMembers();
            }
          });
        }
      }
    });

    // Load saved images from localStorage (avec cache Firebase)
    function getSavedImage(imageId) {
      return localStorage.getItem(`image_${imageId}`) || null;
    }

    // Save image to localStorage and Firebase
    function saveImage(imageId, imageUrl) {
      localStorage.setItem(`image_${imageId}`, imageUrl);
      
      // OBLIGATOIRE: Sauvegarder dans Firebase
      if (typeof saveImageToFirebase === 'function') {
        // Initialiser Firebase si n√©cessaire
        if (!window.firebaseInitialized) {
          initFirebaseDB();
        }
        // Sauvegarder dans Firebase
        saveImageToFirebase(imageId, imageUrl);
        console.log('‚úÖ Image sauvegard√©e dans Firebase:', imageId);
      }
    }

    // Get current image URL (saved or default)
    function getCurrentImage(config) {
      // Check if it's a catalog image
      if (config.id.startsWith('femme_')) {
        const femmesImages = JSON.parse(localStorage.getItem('femmes_images') || '[]');
        const image = femmesImages.find(img => img.id === config.id);
        return image ? image.url : config.default;
      } else if (config.id.startsWith('homme_')) {
        const hommesImages = JSON.parse(localStorage.getItem('hommes_images') || '[]');
        const image = hommesImages.find(img => img.id === config.id);
        return image ? image.url : config.default;
      }
      
      const saved = getSavedImage(config.id);
      return saved || config.default;
    }
    
    // Get image position (object-position)
    function getImagePosition(imageId) {
      const saved = localStorage.getItem(`image_position_${imageId}`);
      if (saved) {
        return saved;
      }
      // Default positions for team members
      const defaultPositions = {
        'julio': 'center 35%',
        'soren': 'center 8%',
        'sun': 'center 3%',
        'inaya': 'center 3%',
        'andres': 'center 0%',
        'yoruhime': 'center 18%'
      };
      return defaultPositions[imageId] || 'center center';
    }

    // Helpers for catalog (femmes/hommes)
    function getCatalogKeyFromId(imageId) {
      if (imageId.startsWith('femme_')) return 'femmes';
      if (imageId.startsWith('homme_')) return 'hommes';
      return null;
    }

    function extractIdNumber(imageId) {
      const match = imageId.match(/_(\d+)/);
      return match ? parseInt(match[1], 10) : Number.MAX_SAFE_INTEGER;
    }

    function normalizeCatalogImages(images, prefix) {
      const normalized = (images || []).map((img, index) => ({
        ...img,
        order: Number(img.order) || index + 1,
        categories: Array.isArray(img.categories)
          ? img.categories.filter(Boolean)
          : []
      }));

      normalized.sort((a, b) => {
        const orderA = Number(a.order) || extractIdNumber(a.id);
        const orderB = Number(b.order) || extractIdNumber(b.id);
        if (orderA === orderB) {
          return extractIdNumber(a.id) - extractIdNumber(b.id);
        }
        return orderA - orderB;
      });

      return normalized.map((img, idx) => ({ ...img, order: idx + 1 }));
    }

    function persistCatalogImages(catalogKey, images) {
      const storageKey = `${catalogKey}_images`;
      localStorage.setItem(storageKey, JSON.stringify(images));

      // OBLIGATOIRE: Sauvegarder dans Firebase
      if (!window.firebaseInitialized) {
        initFirebaseDB();
      }
      
      if (catalogKey === 'femmes' && typeof saveFemmesImagesToFirebase === 'function') {
        saveFemmesImagesToFirebase(images);
        console.log('‚úÖ Images femmes sauvegard√©es dans Firebase');
      }
      if (catalogKey === 'hommes' && typeof saveHommesImagesToFirebase === 'function') {
        saveHommesImagesToFirebase(images);
        console.log('‚úÖ Images hommes sauvegard√©es dans Firebase');
      }
    }
    
    // Save image position
    function saveImagePosition(imageId, position) {
      localStorage.setItem(`image_position_${imageId}`, position);
      
      // OBLIGATOIRE: Sauvegarder dans Firebase
      if (typeof savePositionToFirebase === 'function') {
        if (!window.firebaseInitialized) {
          initFirebaseDB();
        }
        savePositionToFirebase(imageId, position);
        console.log('‚úÖ Position sauvegard√©e dans Firebase:', imageId);
      }
      // Update preview
      const previewImg = document.querySelector(`#preview_${imageId}`);
      if (previewImg) {
        previewImg.style.objectPosition = position;
      }
      // Update display
      const positionDisplay = document.querySelector(`#position_display_${imageId}`);
      if (positionDisplay) {
        positionDisplay.textContent = position;
      }
    }
    
    // Adjust image position
    function adjustImagePosition(imageId, direction) {
      const current = getImagePosition(imageId);
      const parts = current.trim().split(/\s+/);
      let x = parts[0] || 'center';
      let y = parts[1] || 'center';
      
      // Convert center to 50%
      let xValue = 50;
      if (x === 'center') {
        xValue = 50;
      } else if (x.includes('%')) {
        xValue = parseFloat(x);
      } else if (x.includes('px')) {
        xValue = parseFloat(x);
      }
      
      let yValue = 50;
      if (y === 'center') {
        yValue = 50;
      } else if (y.includes('%')) {
        yValue = parseFloat(y);
      } else if (y.includes('px')) {
        yValue = parseFloat(y);
      }
      
      // Adjust based on direction
      switch(direction) {
        case 'left':
          xValue = Math.max(0, xValue - 5);
          break;
        case 'right':
          xValue = Math.min(100, xValue + 5);
          break;
        case 'up':
          yValue = Math.max(0, yValue - 5);
          break;
        case 'down':
          yValue = Math.min(100, yValue + 5);
          break;
      }
      
      // Always use percentage format
      const newPosition = `${xValue}% ${yValue}%`;
      saveImagePosition(imageId, newPosition);
    }
    
    // Reset image position to default
    function resetImagePosition(imageId) {
      const defaultPositions = {
        'julio': 'center 35%',
        'soren': 'center 8%',
        'sun': 'center 3%',
        'inaya': 'center 3%',
        'andres': 'center 0%',
        'yoruhime': 'center 18%'
      };
      const defaultPosition = defaultPositions[imageId] || 'center center';
      saveImagePosition(imageId, defaultPosition);
    }

    // Get team member info
    function getTeamMemberInfo(memberId) {
      const teamMembers = JSON.parse(localStorage.getItem('team_members') || '[]');
      const member = teamMembers.find(m => m.id === memberId);
      if (member) {
        return member;
      }
      // Return default info from config
      const config = imageConfig.team.find(t => t.id === memberId);
      if (config) {
        const defaultInfo = {
          'julio': { firstName: 'Julio', lastName: 'Alvarez', grade: 'Patron', phone: '682-6030' },
          'soren': { firstName: 'Soren', lastName: 'Wanks', grade: 'Co-Patron', phone: '575-5535' },
          'sun': { firstName: 'Sun', lastName: 'Price', grade: 'DRH', phone: '740-3572' },
          'inaya': { firstName: 'Inaya', lastName: 'Kinslow', grade: 'DRH', phone: '344-6279' },
          'andres': { firstName: 'Andres', lastName: 'Henarnandez', grade: 'Responsable Coiffeur', phone: '212-0212' },
          'yoruhime': { firstName: 'Yoruhime', lastName: 'Yoshikage', grade: 'Responsable Tatoueur', phone: '672-0651' }
        };
        return defaultInfo[memberId] || { firstName: '', lastName: '', grade: '', phone: '' };
      }
      return { firstName: '', lastName: '', grade: '', phone: '' };
    }

    // Save team member info
    function saveTeamMemberInfo(memberId, info) {
      const teamMembers = JSON.parse(localStorage.getItem('team_members') || '[]');
      const existingIndex = teamMembers.findIndex(m => m.id === memberId);
      const memberData = { id: memberId, ...info };
      
      if (existingIndex >= 0) {
        teamMembers[existingIndex] = memberData;
      } else {
        teamMembers.push(memberData);
      }
      
      localStorage.setItem('team_members', JSON.stringify(teamMembers));
      
      // OBLIGATOIRE: Sauvegarder dans Firebase
      if (typeof saveTeamMembersToFirebase === 'function') {
        // Initialiser Firebase si n√©cessaire
        if (!window.firebaseInitialized) {
          initFirebaseDB();
        }
        // Sauvegarder dans Firebase
        saveTeamMembersToFirebase(teamMembers);
        console.log('‚úÖ Donn√©es envoy√©es √† Firebase');
      }
    }
    
    // Update team member info from form fields
    function updateTeamMemberInfo(memberId) {
      const firstName = document.getElementById(`firstName_${memberId}`)?.value || '';
      const lastName = document.getElementById(`lastName_${memberId}`)?.value || '';
      const grade = document.getElementById(`grade_${memberId}`)?.value || '';
      const phone = document.getElementById(`phone_${memberId}`)?.value || '';
      
      saveTeamMemberInfo(memberId, { firstName, lastName, grade, phone });
      
      // Update the label
      const item = document.querySelector(`[data-image-id="${memberId}"]`);
      if (item) {
        const label = item.querySelector('.image-label');
        if (label) {
          const fullName = `${firstName} ${lastName}`.trim() || 'Nouvel employ√©';
          label.textContent = fullName;
        }
      }
    }
    
    // Test Firebase Connection
    async function testFirebaseConnection() {
      const btn = document.getElementById('firebaseTestBtn');
      const originalText = btn.textContent;
      btn.textContent = '‚è≥ Test en cours...';
      btn.disabled = true;
      
      try {
        // Initialiser Firebase
        if (!window.firebaseInitialized) {
          initFirebaseDB();
        }
        
        if (!window.firebaseInitialized) {
          throw new Error('Firebase non initialis√©');
        }
        
        // Tenter une √©criture de test
        const testData = {
          timestamp: firebase.firestore.FieldValue.serverTimestamp(),
          message: 'Test de connexion r√©ussi'
        };
        
        await db.collection('test').doc('connection_test').set(testData);
        
        // Lire les donn√©es pour v√©rifier
        const doc = await db.collection('test').doc('connection_test').get();
        
        if (doc.exists) {
          btn.textContent = '‚úÖ Firebase OK!';
          btn.style.color = '#22c55e';
          btn.style.borderColor = 'rgba(34, 197, 94, 0.3)';
          alert('‚úÖ Connexion Firebase r√©ussie!\n\nProjet: vespucci-6b1be\nBase de donn√©es: Firestore\n\nLes donn√©es sont bien sauvegard√©es sur Firebase.');
        } else {
          throw new Error('Impossible de lire le document de test');
        }
      } catch (error) {
        console.error('Erreur Firebase:', error);
        btn.textContent = '‚ùå Erreur Firebase';
        btn.style.color = '#ef4444';
        btn.style.borderColor = 'rgba(239, 68, 68, 0.3)';
        alert('‚ùå Erreur de connexion Firebase:\n' + error.message);
      } finally {
        setTimeout(() => {
          btn.textContent = originalText;
          btn.style.color = '#3b82f6';
          btn.style.borderColor = 'rgba(59, 130, 246, 0.3)';
          btn.disabled = false;
        }, 3000);
      }
    }

    // Create image item HTML
    function createImageItem(config, container, isCustom = false) {
      const currentImage = getCurrentImage(config);
      const item = document.createElement('div');
      item.className = 'image-item';
      item.dataset.imageId = config.id;
      item.dataset.isCustom = isCustom;
      
      const isCatalogImage = config.id.startsWith('femme_') || config.id.startsWith('homme_');
      const isTeamMember = imageConfig.team.some(t => t.id === config.id) || (isCustom && config.id.startsWith('team_'));
      const catalogKey = getCatalogKeyFromId(config.id);
      const orderValue = Number(config.order) || 0;
      const categoriesValue = Array.isArray(config.categories) ? config.categories.join(', ') : '';
      const deleteBtn = (isCustom || isCatalogImage || isTeamMember) ? `<button class="delete-image-btn" onclick="${isCatalogImage ? 'deleteCatalogImage' : (isTeamMember ? 'deleteTeamMember' : 'deleteCustomImage')}('${config.id}')" title="Supprimer">√ó</button>` : '';
      const resetBtn = (!isCustom && !isCatalogImage && !isTeamMember) ? `<button class="remove-btn" onclick="resetImage('${config.id}')" title="R√©initialiser">√ó</button>` : '';
      
      let teamFields = '';
      if (isTeamMember) {
        const memberInfo = getTeamMemberInfo(config.id);
        teamFields = `
          <div class="team-fields">
            <input type="text" class="input-url" id="firstName_${config.id}" placeholder="Pr√©nom" value="${memberInfo.firstName || ''}" onchange="updateTeamMemberInfo('${config.id}')">
            <input type="text" class="input-url" id="lastName_${config.id}" placeholder="Nom" value="${memberInfo.lastName || ''}" onchange="updateTeamMemberInfo('${config.id}')">
            <input type="text" class="input-url" id="grade_${config.id}" placeholder="Grade" value="${memberInfo.grade || ''}" onchange="updateTeamMemberInfo('${config.id}')">
            <input type="text" class="input-url" id="phone_${config.id}" placeholder="T√©l√©phone" value="${memberInfo.phone || ''}" onchange="updateTeamMemberInfo('${config.id}')">
          </div>
        `;
      }
      
      // Get image position
      const imagePosition = getImagePosition(config.id);
      const isCircularPreview = isTeamMember; // Circular for team, rectangular for others
      
      // Image preview with controls
      const imagePreview = `
        <div class="image-preview-container">
          <div class="image-preview-wrapper ${isCircularPreview ? '' : 'rectangular'}">
            <img id="preview_${config.id}" src="${currentImage}" alt="Preview" style="object-position: ${imagePosition}; object-fit: cover; width: 100%; height: 100%;">
          </div>
          <div class="image-position-controls">
            <button class="position-btn" onclick="adjustImagePosition('${config.id}', 'left')" title="Gauche">‚Üê</button>
            <button class="position-btn" onclick="adjustImagePosition('${config.id}', 'up')" title="Haut">‚Üë</button>
            <span class="position-display" id="position_display_${config.id}">${imagePosition}</span>
            <button class="position-btn" onclick="adjustImagePosition('${config.id}', 'down')" title="Bas">‚Üì</button>
            <button class="position-btn" onclick="adjustImagePosition('${config.id}', 'right')" title="Droite">‚Üí</button>
            <button class="position-btn" onclick="resetImagePosition('${config.id}')" title="R√©initialiser" style="font-size: 0.9rem; width: auto; padding: 0 0.75rem;">Reset</button>
          </div>
        </div>
      `;
      
      item.innerHTML = `
        ${deleteBtn}
        <img src="${currentImage}" alt="${config.name}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Crect fill=%22%23333%22 width=%22200%22 height=%22200%22/%3E%3Ctext fill=%22%23999%22 font-family=%22sans-serif%22 font-size=%2214%22 dy=%2210.5%22 font-weight=%22bold%22 x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22%3EImage%3C/text%3E%3C/svg%3E'">
        <div class="image-label">${config.name}</div>
        ${resetBtn}
        ${imagePreview}
        <input type="text" class="input-url" placeholder="URL de l'image" value="${currentImage}" onchange="updateImageUrl('${config.id}', this.value); updatePreviewImage('${config.id}', this.value)">
        <button class="btn-small" onclick="updateImageUrl('${config.id}', this.previousElementSibling.value); ${(config.id.startsWith('femme_') || config.id.startsWith('homme_')) ? 'loadFemmesCatalog(); loadHommesCatalog();' : ''}">Mettre √† jour</button>
        ${isCatalogImage ? `
          <div style="display: flex; gap: 0.5rem; align-items: center; margin-top: 0.75rem; flex-wrap: wrap;">
            <label style="color: var(--text-secondary); font-size: 0.9rem; flex-basis: 100%; margin-bottom: 0.25rem;">üìç Ordre (Position)</label>
            <input type="number" class="input-url" value="${orderValue}" min="0" style="max-width: 80px; flex: 1; min-width: 80px;" onchange="updateCatalogOrder('${config.id}', this.value)">
            <button class="btn-small" style="padding: 0.45rem 0.9rem;" onclick="updateCatalogOrder('${config.id}', ${orderValue} - 1)">‚Üë Haut</button>
            <button class="btn-small" style="padding: 0.45rem 0.9rem;" onclick="updateCatalogOrder('${config.id}', ${orderValue} + 1)">‚Üì Bas</button>
            <button class="btn-small" style="padding: 0.45rem 0.9rem;" onclick="insertAfterCatalog('${config.id}')">+ Apr√®s</button>
          </div>
          <div class="url-input-group">
            <label style="color: var(--text-secondary); font-size: 0.9rem;">Cat√©gories (s√©par√©es par des virgules)</label>
            <input type="text" class="input-url" value="${categoriesValue}" placeholder="ex: afro, tresse" onblur="updateCatalogCategories('${config.id}', this.value)">
          </div>
        ` : ''}
        ${teamFields}
      `;
      
      // Drag and drop
      item.addEventListener('dragover', (e) => {
        e.preventDefault();
        item.classList.add('drag-over');
      });
      
      item.addEventListener('dragleave', () => {
        item.classList.remove('drag-over');
      });
      
      item.addEventListener('drop', (e) => {
        e.preventDefault();
        item.classList.remove('drag-over');
        handleFileDrop(e, config.id);
      });
      
      container.appendChild(item);
    }

    // Handle file drop
    function handleFileDrop(e, imageId) {
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        const file = files[0];
        if (file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = (event) => {
            const dataUrl = event.target.result;
            updateImageUrl(imageId, dataUrl);
            // Update the input field
            const item = document.querySelector(`[data-image-id="${imageId}"]`);
            if (item) {
              const input = item.querySelector('.input-url');
              if (input) input.value = dataUrl;
            }
          };
          reader.readAsDataURL(file);
        } else {
          alert('Veuillez d√©poser une image (JPG, PNG, etc.)');
        }
      }
    }

    // Update preview image
    function updatePreviewImage(imageId, url) {
      const previewImg = document.querySelector(`#preview_${imageId}`);
      if (previewImg) {
        previewImg.src = url;
      }
      const mainImg = document.querySelector(`[data-image-id="${imageId}"] img:not(#preview_${imageId})`);
      if (mainImg) {
        mainImg.src = url;
      }
    }
    
    // Update image URL
    function updateImageUrl(imageId, url) {
      if (!url) return;
      
      // Check if it's a catalog image (femmes/hommes)
      if (imageId.startsWith('femme_') || imageId.startsWith('homme_')) {
        updateCatalogImageUrl(imageId, url);
        updatePreviewImage(imageId, url);
        return;
      }
      
      saveImage(imageId, url);
      updatePreviewImage(imageId, url);
    }

    // Reset image to default
    function resetImage(imageId) {
      const config = [...imageConfig.team, ...imageConfig.gallery].find(c => c.id === imageId) || 
                     (imageConfig.hero.id === imageId ? imageConfig.hero : imageConfig.map);
      
      if (config) {
        localStorage.removeItem(`image_${imageId}`);
        updateImageUrl(imageId, config.default);
        const item = document.querySelector(`[data-image-id="${imageId}"]`);
        if (item) {
          const input = item.querySelector('.input-url');
          if (input) input.value = config.default;
        }
      }
    }

    // Add new gallery image (global function)
    window.addNewGalleryImage = function() {
      const galleryContainer = document.getElementById('galleryImages');
      const existingImages = galleryContainer.querySelectorAll('.image-item').length;
      const customImages = JSON.parse(localStorage.getItem('custom_gallery_images') || '[]');
      const newId = `gallery_custom_${Date.now()}`;
      
      const newConfig = {
        id: newId,
        name: `Galerie ${existingImages + 1}`,
        default: 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Crect fill=%22%23333%22 width=%22200%22 height=%22200%22/%3E%3Ctext fill=%22%23999%22 font-family=%22sans-serif%22 font-size=%2214%22 dy=%2210.5%22 font-weight=%22bold%22 x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22%3ENouvelle%20Image%3C/text%3E%3C/svg%3E'
      };
      
      customImages.push(newId);
      localStorage.setItem('custom_gallery_images', JSON.stringify(customImages));
      if (firebaseInitialized && typeof saveCustomGalleryToFirebase === 'function') {
        saveCustomGalleryToFirebase(customImages);
      }
      
      createImageItem(newConfig, galleryContainer, true);
    };
    
    // Delete custom image
    function deleteCustomImage(imageId) {
      if (confirm('√ätes-vous s√ªr de vouloir supprimer cette image ?')) {
        // Remove from DOM
        const item = document.querySelector(`[data-image-id="${imageId}"]`);
        if (item) {
          item.remove();
        }
        
        // Remove from localStorage
        localStorage.removeItem(`image_${imageId}`);
        
        // Remove from custom images list
        const customImages = JSON.parse(localStorage.getItem('custom_gallery_images') || '[]');
        const updated = customImages.filter(id => id !== imageId);
        localStorage.setItem('custom_gallery_images', JSON.stringify(updated));
        if (firebaseInitialized && typeof saveCustomGalleryToFirebase === 'function') {
          saveCustomGalleryToFirebase(updated);
        }
      }
    }
    
    // Clean and extract URLs from various formats (Goopics, markdown, HTML, etc.)
    window.cleanFemmesUrls = function() {
      const textarea = document.getElementById('femmesUrlsBulk');
      if (!textarea) return;
      
      let text = textarea.value.trim();
      if (!text) {
        alert('Le textarea est vide');
        return;
      }
      
      // Extraire toutes les URLs (supporte plusieurs formats)
      const urlPattern = /https?:\/\/[^\s<>"{}|\\^`\[\]]+/gi;
      const urls = text.match(urlPattern) || [];
      
      // Nettoyer et filtrer les URLs d'images
      const cleanUrls = urls
        .map(url => {
          // Enlever les caract√®res de fin de ligne ou de ponctuation
          url = url.replace(/[.,;:!?)\]}]+$/, '').trim();
          
          // Traiter les URLs Goopics - Format souhait√©: https://i.goopics.net/ID.png (sans chemins)
          if (url.includes('goopics.net')) {
            // Cas 1: URL avec chemin comme https://i.goopics.net/800/gp7sfx.png
            // ‚Üí Extraire uniquement l'ID final (gp7sfx) ‚Üí https://i.goopics.net/gp7sfx.png
            let match = url.match(/i\.goopics\.net\/[^\/]+\/([a-zA-Z0-9]+)(?:\.(png|jpg|jpeg|gif|webp))?/i);
            if (match) {
              return `https://i.goopics.net/${match[1]}.png`;
            }
            
            // Cas 2: URL d√©j√† au bon format https://i.goopics.net/ID.png
            match = url.match(/i\.goopics\.net\/([a-zA-Z0-9]+)(?:\.(png|jpg|jpeg|gif|webp))?/i);
            if (match) {
              // Ignorer les URLs comme https://i.goopics.net/i.png
              if (match[1] === 'i' && (!match[2] || match[2] === 'png')) {
                return null;
              }
              return `https://i.goopics.net/${match[1]}.png`;
            }
            
            // Cas 3: URL de page goopics.net/ID ‚Üí convertir en i.goopics.net/ID.png
            match = url.match(/goopics\.net\/([a-zA-Z0-9]+)(?:\/|$)/i);
            if (match) {
              return `https://i.goopics.net/${match[1]}.png`;
            }
          }
          
          return url;
        })
        .filter(url => url && url.length > 0 && (url.startsWith('http://') || url.startsWith('https://')))
        .filter((url, index, self) => self.indexOf(url) === index); // Supprimer les doublons
      
      if (cleanUrls.length === 0) {
        alert('Aucune URL valide trouv√©e dans le texte');
        return;
      }
      
      // Mettre √† jour le textarea avec les URLs nettoy√©es (une par ligne)
      textarea.value = cleanUrls.join('\n');
      
      // Afficher un message
      const resultDiv = document.getElementById('femmesBulkResult');
      if (resultDiv) {
        resultDiv.style.display = 'block';
        resultDiv.style.background = 'rgba(32, 178, 170, 0.1)';
        resultDiv.style.border = '1px solid var(--primary)';
        resultDiv.style.borderRadius = '10px';
        resultDiv.style.padding = '1rem';
        resultDiv.style.color = 'var(--primary)';
        resultDiv.innerHTML = `üßπ ${cleanUrls.length} URL(s) extraite(s) et nettoy√©e(s) !`;
        setTimeout(() => {
          resultDiv.style.display = 'none';
        }, 3000);
      }
    };
    
    // Clean and extract URLs for hommes
    window.cleanHommesUrls = function() {
      const textarea = document.getElementById('hommesUrlsBulk');
      if (!textarea) return;
      
      let text = textarea.value.trim();
      if (!text) {
        alert('Le textarea est vide');
        return;
      }
      
      // Extraire toutes les URLs (supporte plusieurs formats)
      const urlPattern = /https?:\/\/[^\s<>"{}|\\^`\[\]]+/gi;
      const urls = text.match(urlPattern) || [];
      
      // Nettoyer et filtrer les URLs d'images
      const cleanUrls = urls
        .map(url => {
          // Enlever les caract√®res de fin de ligne ou de ponctuation
          url = url.replace(/[.,;:!?)\]}]+$/, '').trim();
          
          // Traiter les URLs Goopics - Format souhait√©: https://i.goopics.net/ID.png (sans chemins)
          if (url.includes('goopics.net')) {
            // Cas 1: URL avec chemin comme https://i.goopics.net/800/gp7sfx.png
            // ‚Üí Extraire uniquement l'ID final (gp7sfx) ‚Üí https://i.goopics.net/gp7sfx.png
            let match = url.match(/i\.goopics\.net\/[^\/]+\/([a-zA-Z0-9]+)(?:\.(png|jpg|jpeg|gif|webp))?/i);
            if (match) {
              return `https://i.goopics.net/${match[1]}.png`;
            }
            
            // Cas 2: URL d√©j√† au bon format https://i.goopics.net/ID.png
            match = url.match(/i\.goopics\.net\/([a-zA-Z0-9]+)(?:\.(png|jpg|jpeg|gif|webp))?/i);
            if (match) {
              // Ignorer les URLs comme https://i.goopics.net/i.png
              if (match[1] === 'i' && (!match[2] || match[2] === 'png')) {
                return null;
              }
              return `https://i.goopics.net/${match[1]}.png`;
            }
            
            // Cas 3: URL de page goopics.net/ID ‚Üí convertir en i.goopics.net/ID.png
            match = url.match(/goopics\.net\/([a-zA-Z0-9]+)(?:\/|$)/i);
            if (match) {
              return `https://i.goopics.net/${match[1]}.png`;
            }
          }
          
          return url;
        })
        .filter(url => url && url.length > 0 && (url.startsWith('http://') || url.startsWith('https://')))
        .filter((url, index, self) => self.indexOf(url) === index); // Supprimer les doublons
      
      if (cleanUrls.length === 0) {
        alert('Aucune URL valide trouv√©e dans le texte');
        return;
      }
      
      // Mettre √† jour le textarea avec les URLs nettoy√©es (une par ligne)
      textarea.value = cleanUrls.join('\n');
      
      // Afficher un message
      const resultDiv = document.getElementById('hommesBulkResult');
      if (resultDiv) {
        resultDiv.style.display = 'block';
        resultDiv.style.background = 'rgba(32, 178, 170, 0.1)';
        resultDiv.style.border = '1px solid var(--primary)';
        resultDiv.style.borderRadius = '10px';
        resultDiv.style.padding = '1rem';
        resultDiv.style.color = 'var(--primary)';
        resultDiv.innerHTML = `üßπ ${cleanUrls.length} URL(s) extraite(s) et nettoy√©e(s) !`;
        setTimeout(() => {
          resultDiv.style.display = 'none';
        }, 3000);
      }
    };
    
    // Add bulk femmes URLs (global function)
    window.addBulkFemmesUrls = function() {
      const textarea = document.getElementById('femmesUrlsBulk');
      const resultDiv = document.getElementById('femmesBulkResult');
      if (!textarea) return;
      
      const urlsText = textarea.value.trim();
      if (!urlsText) {
        alert('Veuillez entrer au moins une URL');
        return;
      }
      
      // S√©parer les URLs par ligne (supprimer les lignes vides)
      const urls = urlsText.split('\n')
        .map(url => url.trim())
        .filter(url => url.length > 0 && (url.startsWith('http://') || url.startsWith('https://')));
      
      if (urls.length === 0) {
        alert('Aucune URL valide trouv√©e. Les URLs doivent commencer par http:// ou https://');
        return;
      }
      
      // Charger les images existantes
      let femmesImages = JSON.parse(localStorage.getItem('femmes_images') || '[]');
      
      // Trouver le prochain num√©ro disponible
      let nextNumber = 1;
      if (femmesImages.length > 0) {
        const numbers = femmesImages
          .map(img => {
            const match = img.id.match(/femme_(\d+)/);
            return match ? parseInt(match[1]) : 0;
          })
          .filter(n => n > 0)
          .sort((a, b) => b - a);
        nextNumber = numbers.length > 0 ? numbers[0] + 1 : femmesImages.length + 1;
      }
      
      // Ajouter toutes les URLs dans l'ordre
      urls.forEach((url, index) => {
        const currentNumber = nextNumber + index;
        const newId = `femme_${currentNumber}`;
        const newImage = {
          id: newId,
          url: url,
          order: femmesImages.length + 1,
          categories: []
        };
        femmesImages.push(newImage);
      });
      
      // Sauvegarder
      femmesImages = normalizeCatalogImages(femmesImages, 'femme');
      persistCatalogImages('femmes', femmesImages);
      
      // Afficher le r√©sultat
      resultDiv.style.display = 'block';
      resultDiv.style.background = 'rgba(0, 255, 0, 0.1)';
      resultDiv.style.border = '1px solid #4caf50';
      resultDiv.style.borderRadius = '10px';
      resultDiv.style.padding = '1rem';
      resultDiv.style.color = '#4caf50';
      resultDiv.innerHTML = `‚úÖ ${urls.length} image(s) ajout√©e(s) avec succ√®s ! (de femme_${nextNumber} √† femme_${nextNumber + urls.length - 1})`;
      
      // Vider le textarea
      textarea.value = '';
      
      // Recharger le catalogue
      loadFemmesCatalog();
      
      // Masquer le message apr√®s 5 secondes
      setTimeout(() => {
        resultDiv.style.display = 'none';
      }, 5000);
    };
    
    // Add new femmes image (global function)
    window.addNewFemmesImage = function(position = null) {
      let femmesImages = JSON.parse(localStorage.getItem('femmes_images') || '[]');
      femmesImages = normalizeCatalogImages(femmesImages, 'femme');

      const maxId = femmesImages.reduce((max, img) => Math.max(max, extractIdNumber(img.id)), 0);
      const insertPosition = Math.max(1, Math.min(position ? parseInt(position, 10) : femmesImages.length + 1, femmesImages.length + 1));
      const newId = `femme_${maxId + 1}`;
      const newImage = {
        id: newId,
        url: 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Crect fill=%22%23333%22 width=%22200%22 height=%22200%22/%3E%3Ctext fill=%22%23999%22 font-family=%22sans-serif%22 font-size=%2214%22 dy=%2210.5%22 font-weight=%22bold%22 x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22%3ENouvelle%20Image%3C/text%3E%3C/svg%3E',
        order: insertPosition - 0.5,  // Order temporaire entre position-1 et position pour garantir le tri correct
        categories: []
      };

      femmesImages.splice(insertPosition - 1, 0, newImage);
      femmesImages = normalizeCatalogImages(femmesImages, 'femme');
      persistCatalogImages('femmes', femmesImages);
      loadFemmesCatalog();
    };
    
    // Add bulk hommes URLs (global function)
    window.addBulkHommesUrls = function() {
      const textarea = document.getElementById('hommesUrlsBulk');
      const resultDiv = document.getElementById('hommesBulkResult');
      if (!textarea) return;
      
      const urlsText = textarea.value.trim();
      if (!urlsText) {
        alert('Veuillez entrer au moins une URL');
        return;
      }
      
      // S√©parer les URLs par ligne (supprimer les lignes vides)
      const urls = urlsText.split('\n')
        .map(url => url.trim())
        .filter(url => url.length > 0 && (url.startsWith('http://') || url.startsWith('https://')));
      
      if (urls.length === 0) {
        alert('Aucune URL valide trouv√©e. Les URLs doivent commencer par http:// ou https://');
        return;
      }
      
      // Charger les images existantes
      let hommesImages = JSON.parse(localStorage.getItem('hommes_images') || '[]');
      
      // Trouver le prochain num√©ro disponible
      let nextNumber = 1;
      if (hommesImages.length > 0) {
        const numbers = hommesImages
          .map(img => {
            const match = img.id.match(/homme_(\d+)/);
            return match ? parseInt(match[1]) : 0;
          })
          .filter(n => n > 0)
          .sort((a, b) => b - a);
        nextNumber = numbers.length > 0 ? numbers[0] + 1 : hommesImages.length + 1;
      }
      
      // Ajouter toutes les URLs dans l'ordre
      urls.forEach((url, index) => {
        const currentNumber = nextNumber + index;
        const newId = `homme_${currentNumber}`;
        const newImage = {
          id: newId,
          url: url,
          order: hommesImages.length + 1,
          categories: []
        };
        hommesImages.push(newImage);
      });
      
      // Sauvegarder
      hommesImages = normalizeCatalogImages(hommesImages, 'homme');
      persistCatalogImages('hommes', hommesImages);
      
      // Afficher le r√©sultat
      resultDiv.style.display = 'block';
      resultDiv.style.background = 'rgba(0, 255, 0, 0.1)';
      resultDiv.style.border = '1px solid #4caf50';
      resultDiv.style.borderRadius = '10px';
      resultDiv.style.padding = '1rem';
      resultDiv.style.color = '#4caf50';
      resultDiv.innerHTML = `‚úÖ ${urls.length} image(s) ajout√©e(s) avec succ√®s ! (de homme_${nextNumber} √† homme_${nextNumber + urls.length - 1})`;
      
      // Vider le textarea
      textarea.value = '';
      
      // Recharger le catalogue
      loadHommesCatalog();
      
      // Masquer le message apr√®s 5 secondes
      setTimeout(() => {
        resultDiv.style.display = 'none';
      }, 5000);
    };
    
    // Export femmes data (global function)
    window.exportFemmesData = function() {
      const femmesImages = JSON.parse(localStorage.getItem('femmes_images') || '[]');
      const exportData = {
        femmes: femmesImages,
        hommes: []
      };
      const jsonString = JSON.stringify(exportData, null, 2);
      
      const resultDiv = document.getElementById('femmesExportResult');
      const textarea = document.getElementById('femmesExportData');
      if (resultDiv && textarea) {
        textarea.value = jsonString;
        resultDiv.style.display = 'block';
        resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
    };
    
    // Copy femmes export (global function)
    window.copyFemmesExport = function() {
      const textarea = document.getElementById('femmesExportData');
      if (textarea) {
        textarea.select();
        document.execCommand('copy');
        alert('‚úÖ Donn√©es copi√©es ! Collez-les dans catalog-images.json');
      }
    };
    
    // Export hommes data (global function)
    window.exportHommesData = function() {
      const hommesImages = JSON.parse(localStorage.getItem('hommes_images') || '[]');
      const exportData = {
        femmes: [],
        hommes: hommesImages
      };
      const jsonString = JSON.stringify(exportData, null, 2);
      
      const resultDiv = document.getElementById('hommesExportResult');
      const textarea = document.getElementById('hommesExportData');
      if (resultDiv && textarea) {
        textarea.value = jsonString;
        resultDiv.style.display = 'block';
        resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
    };
    
    // Copy hommes export (global function)
    window.copyHommesExport = function() {
      const textarea = document.getElementById('hommesExportData');
      if (textarea) {
        textarea.select();
        document.execCommand('copy');
        alert('‚úÖ Donn√©es copi√©es ! Collez-les dans catalog-images.json');
      }
    };
    
    // Export all data (global function) - Export complet pour catalog-images.json
    window.exportAllCatalogData = function() {
      const femmesImages = JSON.parse(localStorage.getItem('femmes_images') || '[]');
      const hommesImages = JSON.parse(localStorage.getItem('hommes_images') || '[]');
      const exportData = {
        femmes: femmesImages,
        hommes: hommesImages
      };
      const jsonString = JSON.stringify(exportData, null, 2);
      
      // Afficher le JSON dans la zone d'export
      const resultDiv = document.getElementById('globalExportResult');
      const textarea = document.getElementById('globalExportData');
      if (resultDiv && textarea) {
        textarea.value = jsonString;
        resultDiv.style.display = 'block';
        resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
      
      // T√©l√©charger automatiquement le fichier
      const blob = new Blob([jsonString], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'catalog-images.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    };
    
    // Copy global export (global function)
    window.copyGlobalExport = function() {
      const textarea = document.getElementById('globalExportData');
      if (textarea) {
        textarea.select();
        document.execCommand('copy');
        alert('‚úÖ JSON copi√© ! Vous pouvez maintenant le coller dans catalog-images.json');
      }
    };
    
    // Export team data (global function)
    window.exportTeamData = function() {
      const teamMembers = JSON.parse(localStorage.getItem('team_members') || '[]');
      const exportData = {
        team_members: teamMembers
      };
      const jsonString = JSON.stringify(exportData, null, 2);
      
      const resultDiv = document.getElementById('teamExportResult');
      const textarea = document.getElementById('teamExportData');
      if (resultDiv && textarea) {
        textarea.value = jsonString;
        resultDiv.style.display = 'block';
        resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
      
      // T√©l√©charger automatiquement le fichier
      const blob = new Blob([jsonString], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'team-members.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    };
    
    // Copy team export (global function)
    window.copyTeamExport = function() {
      const textarea = document.getElementById('teamExportData');
      if (textarea) {
        textarea.select();
        document.execCommand('copy');
        alert('‚úÖ Donn√©es copi√©es !');
      }
    };
    
    // Export gallery data (global function)
    window.exportGalleryData = function() {
      const customImages = JSON.parse(localStorage.getItem('custom_gallery_images') || '[]');
      const exportData = {
        gallery: customImages
      };
      const jsonString = JSON.stringify(exportData, null, 2);
      
      const resultDiv = document.getElementById('galleryExportResult');
      const textarea = document.getElementById('galleryExportData');
      if (resultDiv && textarea) {
        textarea.value = jsonString;
        resultDiv.style.display = 'block';
        resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
      
      // T√©l√©charger automatiquement le fichier
      const blob = new Blob([jsonString], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'gallery-images.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    };
    
    // Copy gallery export (global function)
    window.copyGalleryExport = function() {
      const textarea = document.getElementById('galleryExportData');
      if (textarea) {
        textarea.select();
        document.execCommand('copy');
        alert('‚úÖ Donn√©es copi√©es !');
      }
    };
    
    // Add new hommes image (global function)
    window.addNewHommesImage = function(position = null) {
      let hommesImages = JSON.parse(localStorage.getItem('hommes_images') || '[]');
      hommesImages = normalizeCatalogImages(hommesImages, 'homme');

      const maxId = hommesImages.reduce((max, img) => Math.max(max, extractIdNumber(img.id)), 0);
      const insertPosition = Math.max(1, Math.min(position ? parseInt(position, 10) : hommesImages.length + 1, hommesImages.length + 1));
      const newId = `homme_${maxId + 1}`;
      const newImage = {
        id: newId,
        url: 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Crect fill=%22%23333%22 width=%22200%22 height=%22200%22/%3E%3Ctext fill=%22%23999%22 font-family=%22sans-serif%22 font-size=%2214%22 dy=%2210.5%22 font-weight=%22bold%22 x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22%3ENouvelle%20Image%3C/text%3E%3C/svg%3E',
        order: insertPosition - 0.5,  // Order temporaire entre position-1 et position pour garantir le tri correct
        categories: []
      };

      hommesImages.splice(insertPosition - 1, 0, newImage);
      hommesImages = normalizeCatalogImages(hommesImages, 'homme');
      persistCatalogImages('hommes', hommesImages);
      loadHommesCatalog();
    };

    function insertAfterCatalog(imageId) {
      const catalogKey = getCatalogKeyFromId(imageId);
      if (!catalogKey) return;
      const storageKey = `${catalogKey}_images`;
      let images = JSON.parse(localStorage.getItem(storageKey) || '[]');
      images = normalizeCatalogImages(images, catalogKey === 'femmes' ? 'femme' : 'homme');
      const target = images.find(img => img.id === imageId);
      if (!target) return;
      const insertPos = (Number(target.order) || 0) + 1;
      if (catalogKey === 'femmes') {
        addNewFemmesImage(insertPos);
      } else {
        addNewHommesImage(insertPos);
      }
    }

    window.insertFemmesImageAtPosition = function() {
      const femmesImages = JSON.parse(localStorage.getItem('femmes_images') || '[]');
      const maxPosition = femmesImages.length + 1;
      const position = parseInt(prompt(`Position d'insertion (1-${maxPosition})`, `${maxPosition}`), 10);
      if (!position || Number.isNaN(position)) return;
      addNewFemmesImage(position);
    };

    window.insertHommesImageAtPosition = function() {
      const hommesImages = JSON.parse(localStorage.getItem('hommes_images') || '[]');
      const maxPosition = hommesImages.length + 1;
      const position = parseInt(prompt(`Position d'insertion (1-${maxPosition})`, `${maxPosition}`), 10);
      if (!position || Number.isNaN(position)) return;
      addNewHommesImage(position);
    };
    
    // Load femmes catalog in admin
    function loadFemmesCatalog() {
      const container = document.getElementById('femmesCatalog');
      let femmesImages = JSON.parse(localStorage.getItem('femmes_images') || '[]');
      
      if (femmesImages.length === 0) {
        for (let i = 1; i <= 6; i++) {
          femmesImages.push({ id: `femme_${i}`, url: `img/femmes/${i}.png` });
        }
        localStorage.setItem('femmes_images', JSON.stringify(femmesImages));
      }
      femmesImages = normalizeCatalogImages(femmesImages, 'femme');
      persistCatalogImages('femmes', femmesImages);
      
      container.innerHTML = '';
      femmesImages.forEach((item) => {
        const config = {
          id: item.id,
          name: `Coupe ${item.order}`,
          default: item.url,
          order: item.order,
          categories: item.categories || []
        };
        createImageItem(config, container, true);
      });
    }
    
    // Load hommes catalog in admin
    function loadHommesCatalog() {
      const container = document.getElementById('hommesCatalog');
      let hommesImages = JSON.parse(localStorage.getItem('hommes_images') || '[]');
      
      if (hommesImages.length === 0) {
        for (let i = 1; i <= 6; i++) {
          hommesImages.push({ id: `homme_${i}`, url: `img/hommes/${i}.png` });
        }
        localStorage.setItem('hommes_images', JSON.stringify(hommesImages));
      }
      hommesImages = normalizeCatalogImages(hommesImages, 'homme');
      persistCatalogImages('hommes', hommesImages);
      
      container.innerHTML = '';
      hommesImages.forEach((item) => {
        const config = {
          id: item.id,
          name: `Coupe ${item.order}`,
          default: item.url,
          order: item.order,
          categories: item.categories || []
        };
        createImageItem(config, container, true);
      });
    }
    
    // Update femmes/hommes image URL
    function updateCatalogImageUrl(imageId, url) {
      if (!url) return;
      
      // Check if it's a femmes image
      if (imageId.startsWith('femme_')) {
        const femmesImages = JSON.parse(localStorage.getItem('femmes_images') || '[]');
        const image = femmesImages.find(img => img.id === imageId);
        if (image) {
          image.url = url;
          const normalized = normalizeCatalogImages(femmesImages, 'femme');
          persistCatalogImages('femmes', normalized);
        }
      }
      // Check if it's a hommes image
      else if (imageId.startsWith('homme_')) {
        const hommesImages = JSON.parse(localStorage.getItem('hommes_images') || '[]');
        const image = hommesImages.find(img => img.id === imageId);
        if (image) {
          image.url = url;
          const normalized = normalizeCatalogImages(hommesImages, 'homme');
          persistCatalogImages('hommes', normalized);
        }
      }
      
      // Update the displayed image
      const item = document.querySelector(`[data-image-id="${imageId}"]`);
      if (item) {
        const img = item.querySelector('img');
        if (img) {
          img.src = url;
        }
      }
    }

    // Diminue tous les ordres de 1 (utile si on commence √† 0)
    function decrementAllOrders(catalogKey = null) {
      const catalogs = catalogKey ? [catalogKey] : ['femmes', 'hommes'];
      
      catalogs.forEach(key => {
        let images = JSON.parse(localStorage.getItem(`${key}_images`) || '[]');
        if (images.length === 0) return;
        
        // Diminuer tous les ordres de 1 (minimum 0)
        images = images.map(img => ({
          ...img,
          order: Math.max(0, (img.order || 1) - 1)
        }));
        
        persistCatalogImages(key, images);
      });
      
      // Recharger l'affichage
      loadFemmesCatalog();
      loadHommesCatalog();
      
      alert('Tous les ordres ont √©t√© diminu√©s de 1 !');
    }

    function updateCatalogOrder(imageId, newPosition) {
      const catalogKey = getCatalogKeyFromId(imageId);
      if (!catalogKey) return;
      let images = JSON.parse(localStorage.getItem(`${catalogKey}_images`) || '[]');
      images = normalizeCatalogImages(images, catalogKey === 'femmes' ? 'femme' : 'homme');

      const currentIndex = images.findIndex(img => img.id === imageId);
      if (currentIndex === -1) return;

      const targetPosition = Math.max(1, Math.min(parseInt(newPosition, 10) || 1, images.length));
      
      // Si la position n'a pas chang√©, ne rien faire
      if (currentIndex === targetPosition - 1) return;
      
      // Retirer l'√©l√©ment de sa position actuelle
      const [moving] = images.splice(currentIndex, 1);
      
      // L'ins√©rer √† la nouvelle position
      images.splice(targetPosition - 1, 0, moving);

      // R√©assigner tous les orders dans l'ordre du tableau
      images = images.map((img, idx) => ({ ...img, order: idx + 1 }));
      persistCatalogImages(catalogKey, images);

      // Recharger l'affichage
      if (catalogKey === 'femmes') {
        loadFemmesCatalog();
      } else {
        loadHommesCatalog();
      }
    }

    function updateCatalogCategories(imageId, rawCategories) {
      const catalogKey = getCatalogKeyFromId(imageId);
      if (!catalogKey) return;
      let images = JSON.parse(localStorage.getItem(`${catalogKey}_images`) || '[]');
      const idx = images.findIndex(img => img.id === imageId);
      if (idx === -1) return;

      const categories = (rawCategories || '')
        .split(',')
        .map(c => c.trim())
        .filter(Boolean);

      images[idx] = {
        ...images[idx],
        categories
      };

      images = normalizeCatalogImages(images, catalogKey === 'femmes' ? 'femme' : 'homme');
      persistCatalogImages(catalogKey, images);
    }
    
    // Delete femmes/hommes image
    function deleteCatalogImage(imageId) {
      if (confirm('√ätes-vous s√ªr de vouloir supprimer cette image ?')) {
        // Remove from DOM
        const item = document.querySelector(`[data-image-id="${imageId}"]`);
        if (item) {
          item.remove();
        }
        
        // Remove from localStorage
        if (imageId.startsWith('femme_')) {
          const femmesImages = JSON.parse(localStorage.getItem('femmes_images') || '[]');
          let updated = femmesImages.filter(img => img.id !== imageId);
          updated = normalizeCatalogImages(updated, 'femme');
          persistCatalogImages('femmes', updated);
          loadFemmesCatalog();
        } else if (imageId.startsWith('homme_')) {
          const hommesImages = JSON.parse(localStorage.getItem('hommes_images') || '[]');
          let updated = hommesImages.filter(img => img.id !== imageId);
          updated = normalizeCatalogImages(updated, 'homme');
          persistCatalogImages('hommes', updated);
          loadHommesCatalog();
        }
      }
    }
    
    // Add new team member (global function)
    window.addNewTeamMember = function() {
      const teamContainer = document.getElementById('teamImages');
      const existingMembers = teamContainer.querySelectorAll('.image-item').length;
      const newId = `team_${Date.now()}`;
      
      const newConfig = {
        id: newId,
        name: `Nouvel employ√© ${existingMembers + 1}`,
        default: 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Crect fill=%22%23333%22 width=%22200%22 height=%22200%22/%3E%3Ctext fill=%22%23999%22 font-family=%22sans-serif%22 font-size=%2214%22 dy=%2210.5%22 font-weight=%22bold%22 x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22%3ENouvelle%20Image%3C/text%3E%3C/svg%3E'
      };
      
      // Save initial team member info
      saveTeamMemberInfo(newId, { firstName: '', lastName: '', grade: '', phone: '' });
      
      createImageItem(newConfig, teamContainer, true);
    };
    
    // Delete team member (global function)
    window.deleteTeamMember = function deleteTeamMember(memberId) {
      if (confirm('√ätes-vous s√ªr de vouloir supprimer cet employ√© ?')) {
        // Remove from DOM
        const item = document.querySelector(`[data-image-id="${memberId}"]`);
        if (item) {
          item.remove();
        }
        
        // Remove from localStorage
        localStorage.removeItem(`image_${memberId}`);
        const teamMembers = JSON.parse(localStorage.getItem('team_members') || '[]');
        const updated = teamMembers.filter(m => m.id !== memberId);
        localStorage.setItem('team_members', JSON.stringify(updated));
        if (firebaseInitialized && typeof saveTeamMembersToFirebase === 'function') {
          saveTeamMembersToFirebase(updated);
        }
        
        // Mark as deleted if it's a default member
        const deletedMembers = JSON.parse(localStorage.getItem('deleted_team_members') || '[]');
        if (!deletedMembers.includes(memberId)) {
          deletedMembers.push(memberId);
          localStorage.setItem('deleted_team_members', JSON.stringify(deletedMembers));
          if (firebaseInitialized && typeof saveDeletedTeamMembersToFirebase === 'function') {
            saveDeletedTeamMembersToFirebase(deletedMembers);
          }
        }
      }
    };
    
    // Save all images
    function saveAllImages() {
      const message = document.getElementById('successMessage');
      message.classList.add('show');
      setTimeout(() => {
        message.classList.remove('show');
      }, 3000);
      
      // Reload the page to show updated images
      setTimeout(() => {
        window.location.reload();
      }, 1000);
    }
    
    // D√©connexion (optionnel - vous pouvez ajouter un bouton de d√©connexion)
    function logout() {
      if (confirm('√ätes-vous s√ªr de vouloir vous d√©connecter ?')) {
        sessionStorage.removeItem('adminAuthenticated');
        // Utiliser un chemin absolu depuis la racine
        const rootPath = window.location.origin + window.location.pathname.split('/').slice(0, -1).join('/');
        window.location.href = rootPath + '/admin-login.html';
      }
    }

    // Load team members
    function loadTeamMembers() {
      const teamContainer = document.getElementById('teamImages');
      if (!teamContainer) return;
      
      // Clear container first to avoid duplicates
      teamContainer.innerHTML = '';
      
      const teamMembers = JSON.parse(localStorage.getItem('team_members') || '[]');
      const deletedMembers = JSON.parse(localStorage.getItem('deleted_team_members') || '[]');
      const defaultMembers = imageConfig.team.map(t => t.id);
      
      // Load default team members (excluding deleted ones)
      imageConfig.team.forEach(config => {
        if (!deletedMembers.includes(config.id)) {
          createImageItem(config, teamContainer);
        }
      });
      
      // Load custom team members
      teamMembers.forEach(member => {
        if (!defaultMembers.includes(member.id) && member.id.startsWith('team_')) {
          const savedImage = localStorage.getItem(`image_${member.id}`);
          const config = {
            id: member.id,
            name: `${member.firstName || ''} ${member.lastName || ''}`.trim() || 'Nouvel employ√©',
            default: savedImage || 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Crect fill=%22%23333%22 width=%22200%22 height=%22200%22/%3E%3Ctext fill=%22%23999%22 font-family=%22sans-serif%22 font-size=%2214%22 dy=%2210.5%22 font-weight=%22bold%22 x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22%3ENouvelle%20Image%3C/text%3E%3C/svg%3E'
          };
          createImageItem(config, teamContainer, true);
        }
      });
    }

    // Initialize admin page
    function initAdmin() {
      // Load team images
      loadTeamMembers();

      // Load gallery images
      const galleryContainer = document.getElementById('galleryImages');
      imageConfig.gallery.forEach(config => {
        createImageItem(config, galleryContainer);
      });
      
      // Load custom gallery images
      const customImages = JSON.parse(localStorage.getItem('custom_gallery_images') || '[]');
      customImages.forEach(imageId => {
        const saved = localStorage.getItem(`image_${imageId}`);
        if (saved) {
          const name = `Galerie ${galleryContainer.querySelectorAll('.image-item').length + 1}`;
          const config = {
            id: imageId,
            name: name,
            default: saved
          };
          createImageItem(config, galleryContainer, true);
        }
      });

      // Load hero image
      const heroContainer = document.getElementById('heroImage');
      createImageItem(imageConfig.hero, heroContainer);

      // Load map image
      const mapContainer = document.getElementById('mapImage');
      createImageItem(imageConfig.map, mapContainer);
      
      // Load femmes catalog
      loadFemmesCatalog();
      
      // Load hommes catalog
      loadHommesCatalog();
    }

    // Initialize on load
    document.addEventListener('DOMContentLoaded', initAdmin);

    // Prevent default drag behavior on page
    document.addEventListener('dragover', (e) => e.preventDefault());
    document.addEventListener('drop', (e) => e.preventDefault());
    
    // Navigation Toggle
    const navToggle = document.getElementById('navToggle');
    const navLinks = document.querySelector('.nav-links');
    
    if (navToggle) {
      navToggle.addEventListener('click', () => {
        navLinks.classList.toggle('active');
        navToggle.classList.toggle('active');
      });
    }
  </script>
  <script src="assets/burger-menu.js" defer></script>
</body>
</html>

